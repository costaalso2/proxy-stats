<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Proxy Monitor</title>
  <style>
    body {
      font-family: sans-serif;
      background: #0f0f0f;
      color: white;
      text-align: center;
      padding: 20px;
    }
    .card {
      background: #1a1a1a;
      padding: 25px;
      border-radius: 20px;
      display: inline-block;
      width: 90%;
      max-width: 350px;
      border: 1px solid #333;
      box-shadow: 0 0 15px rgba(0,255,100,0.2);
    }
    .progress-bg {
      background: #333;
      border-radius: 15px;
      height: 30px;
      margin: 20px 0;
      overflow: hidden;
    }
    #bar {
      height: 100%;
      width: 0%;
      transition: width 1.5s ease-in-out;
    }
    button, select {
      margin: 10px;
      padding: 10px 20px;
      background: #333;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    button:hover, select:hover {
      background: #555;
    }
    #extra-stats {
      margin-top: 20px;
      font-size: 14px;
      color: #ccc;
      text-align: left;
    }
    #extra-stats p {
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <!-- Botones de interfaz -->
  <button id="mode-toggle">Modo: Real</button>
  <button id="lang-toggle">üåê Idioma: Espa√±ol</button>

  <div class="card">
    <div id="percent-text" style="font-weight: bold; font-size: 20px;">...</div>
    <div class="progress-bg">
      <div id="bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
    </div>
    <div id="usage-text">0 MB / 1024 MB</div>
    <p id="limit-label" style="font-size: 12px; color: #888; margin-top: 15px;"></p>

    <!-- Selector de velocidad -->
    <div style="margin-top: 20px;">
      <label for="speed-select">‚è±Ô∏è Actualizaci√≥n:</label>
      <select id="speed-select">
        <option value="0">Solo al entrar</option>
        <option value="10000">Cada 10 segundos</option>
        <option value="30000">Cada 30 segundos</option>
        <option value="60000" selected>Cada 60 segundos</option>
      </select>
    </div>

    <!-- Estad√≠sticas adicionales -->
    <div id="extra-stats">
      <p id="requests-label">üì¶ Solicitudes: <span id="requests">--</span></p>
      <p id="projected-label">üìà Proyecci√≥n mensual: <span id="projected">--</span></p>
      <p id="cycle-label">üóìÔ∏è Ciclo: <span id="cycle">--</span></p>
    </div>
  </div>

  <script>
    const limitMB = 1024;
    let demoMode = false;
    let simulatedUsed = 0;

    const percentText = document.getElementById('percent-text');
    const usageText = document.getElementById('usage-text');
    const limitLabel = document.getElementById('limit-label');
    const bar = document.getElementById('bar');
    const toggleBtn = document.getElementById('mode-toggle');
    const speedSelect = document.getElementById('speed-select');
    const langBtn = document.getElementById('lang-toggle');

    // Diccionario de idiomas (ejemplo con 2, puedes ampliar)
    let currentLang = localStorage.getItem("proxyLang") || "es";
    const translations = {
      es:{loading:"Cargando...",used:"Usado",limit:"L√≠mite",error:"Error de Conexi√≥n",requests:"üì¶ Solicitudes",projected:"üìà Proyecci√≥n mensual",cycle:"üóìÔ∏è Ciclo",langLabel:"üåê Idioma: Espa√±ol",modeReal:"Modo: Real",modeDemo:"Modo: Demo"},
      en:{loading:"Loading...",used:"Used",limit:"Limit",error:"Connection Error",requests:"üì¶ Requests",projected:"üìà Monthly Projection",cycle:"üóìÔ∏è Cycle",langLabel:"üåê Language: English",modeReal:"Mode: Real",modeDemo:"Mode: Demo"}
    };
    const langList = Object.keys(translations);

    function setLanguage(lang) {
      currentLang = lang;
      localStorage.setItem("proxyLang", lang);
      langBtn.innerText = translations[lang].langLabel;
      limitLabel.innerText = `${translations[lang].limit}: ${(limitMB / 1024).toFixed(1)} GB`;
      document.getElementById("requests-label").firstChild.textContent = translations[lang].requests + ": ";
      document.getElementById("projected-label").firstChild.textContent = translations[lang].projected + ": ";
      document.getElementById("cycle-label").firstChild.textContent = translations[lang].cycle + ": ";
      toggleBtn.innerText = demoMode ? translations[lang].modeDemo : translations[lang].modeReal;
    }

    langBtn.onclick = () => {
      const currentIndex = langList.indexOf(currentLang);
      const nextIndex = (currentIndex + 1) % langList.length;
      setLanguage(langList[nextIndex]);
    };

    // Guardar modo y velocidad
    const savedMode = localStorage.getItem("proxyMode");
    const savedSpeed = localStorage.getItem("proxySpeed");
    if (savedMode) demoMode = savedMode === "demo";
    if (savedSpeed) speedSelect.value = savedSpeed;

    toggleBtn.innerText = demoMode ? translations[currentLang].modeDemo : translations[currentLang].modeReal;

    toggleBtn.onclick = () => {
      demoMode = !demoMode;
      localStorage.setItem("proxyMode", demoMode ? "demo" : "real");
      toggleBtn.innerText = demoMode ? translations[currentLang].modeDemo : translations[currentLang].modeReal;
      update();
    };

    speedSelect.onchange = (e) => {
      const speed = parseInt(e.target.value);
      localStorage.setItem("proxySpeed", speed);
      clearInterval(window.proxyInterval);
      if (speed > 0) window.proxyInterval = setInterval(update, speed);
    };

    function render(percent, used) {
      bar.style.width = percent + "%";
      bar.setAttribute("aria-valuenow", percent);

      if (percent > 80) bar.style.background = "#ff5252";
      else if (percent > 50) bar.style.background = "#ffeb3b";
      else bar.style.background = "linear-gradient(90deg, #00c853, #b2ff59)";

      percentText.innerText = `${percent}% ${translations[currentLang].used}`;
      usageText.innerText = `${used} MB / ${limitMB} MB`;
    }

    function renderStats(requests, projected, start, end) {
      document.getElementById("requests").innerText = requests || "--";
      document.getElementById("projected").innerText = projected || "--";
      document.getElementById("cycle").innerText = start && end ? `${start} ‚Üí ${end}` : "--";
    }

    function simulateData() {
      simulatedUsed += Math.random() * 20;
      if (simulatedUsed > limitMB) simulatedUsed = 0;
      const used = simulatedUsed.toFixed(2);
      const percent = Math.min((used / limitMB) * 100, 100).toFixed(1);
      render(percent, used);
      renderStats("5,333", "20.56 GB", "07 Ene 2026", "06 Feb 2026");
    }

    async function update() {
      if (demoMode) return simulateData();

      const token = "2x3wt52c4rtbdbav7u4of5v4jgep9dfp1dj98zap";
      const api = "https://proxy.webshare.io/api/v2/proxy/stats/bandwidth/";
      const url = "https://corsproxy.io/?" + encodeURIComponent(api);

      try {
        const res = await fetch(url, { headers: { 'Authorization': `Token ${token}` } });
        const data = await res.json();
        const used = (data.actual_usage / 1048576).toFixed(2);
        const percent = Math.min((used / limitMB) * 100, 100).toFixed(1);
        render(percent, used);
